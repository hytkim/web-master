<html>

<head>
  <!-- ↓ 구글 라이브러리 ↓ -->
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

  <!-- ↓ 구글이만든함수 ↓ -->
  <script type="text/javascript">
    let chartData = [ ['User', 'Point'] ];

    // 비동기처리는 실행순서가 중요하기때문에 구글차트를 불러오는 순서를 수정
    // 하여 비동기함수에서 차트데이터를 넣어준 뒤로 미룬다. 
    const xhtp = new XMLHttpRequest();
    xhtp.open('get', 'http://localhost:3000/points');
    xhtp.send();
    xhtp.onload = () => {
      //chartData = JSON.parse(xhtp.response);
      console.log(JSON.parse(xhtp.response));
      JSON.parse(xhtp.response).forEach((item) => {
        chartData.push([item.id, item.point]);
      });
      console.log(chartData);

      google.charts.load('current', { 'packages': ['corechart'] });
      google.charts.setOnLoadCallback(drawChart);
    };

    function drawChart() {

      // var data = google.visualization.arrayToDataTable([
      //   ['Task', 'Hours per Day'],
      //   ['Work',     11],
      //   ['Eat',      200],
      //   ['Commute',  2],
      //   ['Watch TV', 2],
      //   ['Sleep',    7],
      //   ['game',     30]
      // ]);
      var data = google.visualization.arrayToDataTable(chartData);

      var options = {
        // title: 'My Daily Activities'
        title: '총 포인트 회원 별 분포 차트'
      };

      var chart = new google.visualization.PieChart(document.getElementById('piechart'));

      chart.draw(data, options);
    }
  </script>
</head>

<body>
  <div id="piechart" style="width: 100%; height: 50%;"></div>
</body>

</html>